# Deployment script for Windows
# This script is configured by CMake and executed during installation

set(QT_DEPLOY_BIN "@QT_WINDEPLOYQT_EXECUTABLE@")
set(TARGET_FILE "@CMAKE_INSTALL_PREFIX@/bin/JitsiMeetQt.exe")
set(QML_SOURCE_PATH "@CMAKE_SOURCE_DIR@")

# Execute windeployqt
if(EXISTS "${QT_DEPLOY_BIN}")
    message(STATUS "Deploying Qt libraries...")
    execute_process(
        COMMAND "${QT_DEPLOY_BIN}"
            --release
            --no-translations
            --no-system-d3d-compiler
            --no-opengl-sw
            --no-compiler-runtime
            "${TARGET_FILE}"
        WORKING_DIRECTORY "@CMAKE_INSTALL_PREFIX@/bin"
        RESULT_VARIABLE DEPLOY_RESULT
    )
    
    if(NOT DEPLOY_RESULT EQUAL 0)
        message(WARNING "windeployqt failed with result: ${DEPLOY_RESULT}")
    else()
        message(STATUS "Qt libraries deployed successfully")
    endif()
else()
    message(WARNING "windeployqt not found at: ${QT_DEPLOY_BIN}")
endif()

# Copy additional files
file(COPY "@CMAKE_SOURCE_DIR@/LICENSE" DESTINATION "@CMAKE_INSTALL_PREFIX@")
file(COPY "@CMAKE_SOURCE_DIR@/README.md" DESTINATION "@CMAKE_INSTALL_PREFIX@")

# Copy translations
file(GLOB TRANSLATION_FILES "@CMAKE_BINARY_DIR@/*.qm")
if(TRANSLATION_FILES)
    file(COPY ${TRANSLATION_FILES} DESTINATION "@CMAKE_INSTALL_PREFIX@/translations")
endif()